:load format.csv

function test {
  typeset result

  [[ $(printf 'a,b\n' | format.csv.parse) = $'a\nb' ]] || return 1

  result=$(printf "a\n\$'b\\\\nc'\nd\ne") 
  [[ $(printf 'a,"b\nc"\nd,"e"\n' | format.csv.parse) = "$result" ]] || return 1
  [[ $(printf 'a,b' | format.csv.parse) = $'a\nb' ]] || return 1
  [[ $(printf 'a,' | format.csv.parse) = $'a\n\'\'' ]] || return 1

  return 0
}

test
